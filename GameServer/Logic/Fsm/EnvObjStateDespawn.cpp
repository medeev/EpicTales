

#include "Pch.h"
#include "EnvObjStateDespawn.h"

#include <Data/Info/EnvObjInfo.h>

#include "Actor/EnvObj.h"

////////////////////////////////////////////////////////////////////////////////////////////////////
/// @ brief	생성자
////////////////////////////////////////////////////////////////////////////////////////////////////
EnvObjStateDespawn::EnvObjStateDespawn(FsmComponent& fsm, EnvObj& gadget, EFsmStateType type)
	:
	super(fsm, gadget, type)
{
	_despawnEndTime = 0;
}

////////////////////////////////////////////////////////////////////////////////////////////////////
/// @ brief	스테이트가 갱신될 때를 처리한다.
////////////////////////////////////////////////////////////////////////////////////////////////////
void EnvObjStateDespawn::onUpdate(int64_t curtimeValue)
{
	if (_despawnEndTime && _despawnEndTime < curtimeValue)
	{
		_despawnEndTime = 0;
		_envObj.setRoomRemovable(true);
	}
}
////////////////////////////////////////////////////////////////////////////////////////////////////
/// @ brief	스테이트에 진입할 때를 처리한다
////////////////////////////////////////////////////////////////////////////////////////////////////
void EnvObjStateDespawn::onEnter(IState* prevState, const StateInit* init)
{
	super::onEnter(prevState, init);

	if (auto room = _envObj.getRoom())
	{
		if (_envObj.getInfo().getLifeTime())
			_despawnEndTime = room->getTime() + _envObj.getInfo().getLifeTime();
	}
}

