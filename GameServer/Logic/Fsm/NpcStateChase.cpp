

#include "Pch.h"
#include "NpcStateChase.h"

#include <Core/Math/Numeric.h>
#include <Protocol/PktCommon.h>

#include "Actor/Npc.h"
#include "Config.h"
#include "Logic/Npc/NpcMoveComponent.h"
#include "Logic/NpcAi/NpcAiComponent.h"

////////////////////////////////////////////////////////////////////////////////////////////////////
/// @ brief	생성자
////////////////////////////////////////////////////////////////////////////////////////////////////
NpcStateChase::NpcStateChase(FsmComponent& fsm, Npc& npc, EFsmStateType type)
	:
	super(fsm, npc, type)
{
	_setUpdateTimeInterval(100);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
/// @ brief	상태에 진입힌다.
////////////////////////////////////////////////////////////////////////////////////////////////////
void NpcStateChase::onEnter(IState* prevState, const StateInit* init)
{
	super::onEnter(prevState, init);

	_setUpdateTimeInterval(100);
	_setLookTimeInterval(1000);

	_npc.enterCombat();
}

////////////////////////////////////////////////////////////////////////////////////////////////////
/// @brief  나갈때 처리한다.
////////////////////////////////////////////////////////////////////////////////////////////////////
void NpcStateChase::onExit(IState* newState)
{
	NpcStateBase::onExit(newState);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
/// @ brief	상태를 업데이트한다.
////////////////////////////////////////////////////////////////////////////////////////////////////
void NpcStateChase::onUpdate(int64_t curtimeValue)
{
	if (!_isUpdateTime(curtimeValue))
		return;

	_setNextUpdateTime(curtimeValue);


	if (_isLookTime(curtimeValue))
	{
		_setNextLookTime(curtimeValue);
	}



}

////////////////////////////////////////////////////////////////////////////////////////////////////
/// @ brief  돌아가기 상태로 가야 할지 여부를 반환한다.
////////////////////////////////////////////////////////////////////////////////////////////////////
bool NpcStateChase::_isReturn(ActorPtr target, int64_t curTimeValue) const
{
	if (!target)
		return true;

	return false;
}
