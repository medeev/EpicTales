

#include "Pch.h"
#include "NpcStateSpawn.h"

#include "Actor/Npc.h"
#include "Actor/Player.h"
#include "Room/World.h"

////////////////////////////////////////////////////////////////////////////////////////////////////
/// @ brief		생성자
////////////////////////////////////////////////////////////////////////////////////////////////////
NpcStateSpawn::NpcStateSpawn(FsmComponent& fsm, Npc& npc, EFsmStateType type)
	:
	super(fsm, npc, type)
{

}

////////////////////////////////////////////////////////////////////////////////////////////////////
/// @ brief	스폰상태에 진입한다.
////////////////////////////////////////////////////////////////////////////////////////////////////
void NpcStateSpawn::onEnter(IState* prevState, const StateInit* init)
{
	super::onEnter(prevState, init);

	_npc.getNpcAiComponent().updateOnceAi();
	
	if (auto room = _npc.getRoom())
	{
		_endTime = room->getTime();
	}
}

////////////////////////////////////////////////////////////////////////////////////////////////////
/// @ brief	스테이트를 업데이트한다.
////////////////////////////////////////////////////////////////////////////////////////////////////
void NpcStateSpawn::onUpdate(int64_t curtimeValue)
{
	if (_endTime < curtimeValue)
		_fsm.changeState(EFsmStateType::NpcStateIdle);
}

