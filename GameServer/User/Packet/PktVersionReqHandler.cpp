////////////////////////////////////////////////////////////////////////////////////////////////////
/// @brief PktVersionReqHandler 의 소스 파일입니다.
////////////////////////////////////////////////////////////////////////////////////////////////////

#include "Pch.h"
#include "PktVersionReqHandler.h"

#include <Protocol/Struct/PktSystem.h>
#include <Protocol/Struct/PktTypes.h>

#include "../User.h"

////////////////////////////////////////////////////////////////////////////////////////////////////
/// @brief 패킷을 처리한다
////////////////////////////////////////////////////////////////////////////////////////////////////
void PktVersionReqHandler::onHandler(User& user, PktVersionReq& req)
{
	std::shared_ptr<Ack> ack = std::make_shared<Ack>();
	ack->setReqKey(req.getReqKey());
	_onHandler(user, req, ack);
}

////////////////////////////////////////////////////////////////////////////////////////////////////
/// @brief 패킷을 처리한다
////////////////////////////////////////////////////////////////////////////////////////////////////
void PktVersionReqHandler::_onHandler(User& user, PktVersionReq& req, std::shared_ptr<Ack>& ack)
{
	auto mSec = Core::Time::GetCurTimeMSec();
	user.setPacketVersion(req.getPacketVersion());
	user.setLatencyCheckTime(mSec);

	ack->setVersion(PktVersion(majorVer, minorVer, patchVer));
	ack->setServerMSec(mSec);

	user.send(*ack);
}


